<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bird Quiz — Auto Images (Proxy, No Spoilers)</title>
<style>
  :root { --bg:#f7f7f8; --panel:#fff; --border:#e5e7eb; --text:#111827; --accent:#2563eb; --muted:#6b7280; --ok:#065f46; --warn:#b91c1c; }
  * { box-sizing:border-box; }
  body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color:var(--text); background:var(--bg); display:flex; min-height:100vh; }
  #sidebar { width:300px; background:var(--panel); border-right:1px solid var(--border); padding:20px; }
  #main { flex:1; padding:24px; display:flex; flex-direction:column; align-items:center; gap:16px; }
  h1 { font-size:20px; margin:0 0 8px; }
  .muted { color:var(--muted); font-size:12px; margin:0 0 16px; }
  fieldset { border:0; padding:0; margin:0 0 12px; }
  label { display:block; margin:6px 0; font-size:14px; }
  button { appearance:none; border:1px solid var(--border); background:var(--panel); color:var(--text); padding:10px 14px; border-radius:8px; cursor:pointer; transition:.15s ease; font-weight:600; }
  button:hover { border-color:#cbd5e1; box-shadow:0 1px 0 rgba(0,0,0,.03); }
  button.primary { background:var(--accent); color:#fff; border-color:var(--accent); }
  img { max-width:560px; max-height:380px; width:100%; object-fit:contain; border:1px solid var(--border); background:#fff; border-radius:10px; display:none; }
  .row { display:flex; gap:8px; flex-wrap:wrap; }
  .answer { font-style:italic; min-height:20px; }
  #status { font-size:12px; color:var(--muted); min-height:18px; }
  .spinner { width:16px; height:16px; border:2px solid #e5e7eb; border-top-color: var(--accent); border-radius:50%; animation: spin 0.8s linear infinite; display:inline-block; vertical-align:middle; }
  @keyframes spin { to { transform: rotate(360deg); } }
</style>
</head>
<body>
  <aside id="sidebar">
    <h2 style="margin:0 0 8px; font-size:18px;">Filter by location</h2>
    <p class="muted">Images are pulled automatically (no uploads). Uses a reliable proxy to avoid hotlink/CORS issues on GitHub Pages.</p>
    <fieldset id="filters">
      <label><input type="radio" name="location" value="all" checked> All</label>
      <label><input type="radio" name="location" value="us"> United States</label>
      <label><input type="radio" name="location" value="midwest"> US Midwest</label>
      <label><input type="radio" name="location" value="east"> US East Coast</label>
      <label><input type="radio" name="location" value="west"> US West Coast</label>
      <label><input type="radio" name="location" value="south"> US South</label>
      <label><input type="radio" name="location" value="canada"> Canada</label>
      <label><input type="radio" name="location" value="europe"> Europe</label>
    </fieldset>
  </aside>

  <main id="main">
    <h1>Bird Quiz</h1>
    <p class="muted">No spoilers while loading. “I don’t know it” reveals the name. If a source fails, it auto-tries alternates and then a safe fallback.</p>
    <div class="row">
      <button id="quizBtn" class="primary">Quiz me on a bird</button>
      <button id="knowBtn" disabled>I know it</button>
      <button id="dontKnowBtn" disabled>I don’t know it</button>
    </div>
    <div id="status"></div>
    <img id="birdImage" alt="Bird image" referrerpolicy="no-referrer" crossorigin="anonymous">
    <div id="birdName" class="answer"></div>
  </main>

<script>
// Built-in, guaranteed fallback image (inline SVG)
const INLINE_FALLBACK = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='560' height='380' viewBox='0 0 560 380'%3E%3Crect width='100%25' height='100%25' fill='%23ffffff'/%3E%3Ctext x='50%25' y='20%25' dominant-baseline='middle' text-anchor='middle' fill='%239aa1ab' font-family='Arial' font-size='16'%3EBird image fallback%3C/text%3E%3Cpath d='M120 250c60-80 140-80 200-60 30 10 60 10 100-10-30 40-60 60-90 70 10 10 40 30 70 40-60-10-110-40-150-60-20 30-60 50-130 20z' fill='%2390caf9'/%3E%3C/svg%3E";

// Helper: route any URL via images.weserv.nl proxy to avoid GitHub Pages hotlink/CORS issues
function viaProxy(url){
  try{
    const u = new URL(url);
    // weserv expects host+path (no protocol)
    const hostPath = u.host + u.pathname + (u.search || '');
    return `https://images.weserv.nl/?url=${encodeURIComponent(hostPath)}`;
  }catch{ return url; }
}

// Big automatic set with alternates per species (Wikimedia). First that loads wins.
// For each bird we list 2–3 candidates: thumb, original, Special:FilePath
const CANDIDATES = {
  "American Robin": [
    "https://upload.wikimedia.org/wikipedia/commons/thumb/5/56/American_Robin.jpg/640px-American_Robin.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/5/56/American_Robin.jpg",
    "https://commons.wikimedia.org/wiki/Special:FilePath/American_Robin.jpg?width=640"
  ],
  "Northern Cardinal": [
    "https://upload.wikimedia.org/wikipedia/commons/thumb/8/84/Northern_Cardinal_male.jpg/640px-Northern_Cardinal_male.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/8/84/Northern_Cardinal_male.jpg",
    "https://commons.wikimedia.org/wiki/Special:FilePath/Northern_Cardinal_male.jpg?width=640"
  ],
  "Blue Jay": [
    "https://upload.wikimedia.org/wikipedia/commons/thumb/8/80/Blue_Jay.jpg/640px-Blue_Jay.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/8/80/Blue_Jay.jpg",
    "https://commons.wikimedia.org/wiki/Special:FilePath/Blue_Jay.jpg?width=640"
  ],
  "Mallard": [
    "https://upload.wikimedia.org/wikipedia/commons/thumb/5/51/Mallard_drake.jpg/640px-Mallard_drake.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/5/51/Mallard_drake.jpg",
    "https://commons.wikimedia.org/wiki/Special:FilePath/Mallard_drake.jpg?width=640"
  ],
  "European Goldfinch": [
    "https://upload.wikimedia.org/wikipedia/commons/thumb/b/b4/European_Goldfinch.jpg/640px-European_Goldfinch.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/b/b4/European_Goldfinch.jpg",
    "https://commons.wikimedia.org/wiki/Special:FilePath/European_Goldfinch.jpg?width=640"
  ],
  "California Scrub Jay": [
    "https://upload.wikimedia.org/wikipedia/commons/thumb/4/47/California_Scrub_Jay.jpg/640px-California_Scrub_Jay.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/4/47/California_Scrub_Jay.jpg",
    "https://commons.wikimedia.org/wiki/Special:FilePath/California_Scrub_Jay.jpg?width=640"
  ],
  "Northern Mockingbird": [
    "https://upload.wikimedia.org/wikipedia/commons/thumb/5/5d/Northern_Mockingbird.jpg/640px-Northern_Mockingbird.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/5/5d/Northern_Mockingbird.jpg",
    "https://commons.wikimedia.org/wiki/Special:FilePath/Northern_Mockingbird.jpg?width=640"
  ],
  "Gray Jay": [
    "https://upload.wikimedia.org/wikipedia/commons/thumb/3/35/Gray_Jay.jpg/640px-Gray_Jay.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/3/35/Gray_Jay.jpg",
    "https://commons.wikimedia.org/wiki/Special:FilePath/Gray_Jay.jpg?width=640"
  ],
  "American Goldfinch": [
    "https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/American_Goldfinch.jpg/640px-American_Goldfinch.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/5/5e/American_Goldfinch.jpg",
    "https://commons.wikimedia.org/wiki/Special:FilePath/American_Goldfinch.jpg?width=640"
  ],
  "Downy Woodpecker": [
    "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f6/Downy_Woodpecker.jpg/640px-Downy_Woodpecker.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/f/f6/Downy_Woodpecker.jpg",
    "https://commons.wikimedia.org/wiki/Special:FilePath/Downy_Woodpecker.jpg?width=640"
  ],
  "Red-tailed Hawk": [
    "https://upload.wikimedia.org/wikipedia/commons/thumb/2/28/Red-tailed_Hawk.jpg/640px-Red-tailed_Hawk.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/2/28/Red-tailed_Hawk.jpg",
    "https://commons.wikimedia.org/wiki/Special:FilePath/Red-tailed_Hawk.jpg?width=640"
  ],
  "Great Blue Heron": [
    "https://upload.wikimedia.org/wikipedia/commons/thumb/3/3a/Great_Blue_Heron.jpg/640px-Great_Blue_Heron.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/3/3a/Great_Blue_Heron.jpg",
    "https://commons.wikimedia.org/wiki/Special:FilePath/Great_Blue_Heron.jpg?width=640"
  ],
  "Black-capped Chickadee": [
    "https://upload.wikimedia.org/wikipedia/commons/thumb/1/1d/Black-capped_Chickadee.jpg/640px-Black-capped_Chickadee.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/1/1d/Black-capped_Chickadee.jpg",
    "https://commons.wikimedia.org/wiki/Special:FilePath/Black-capped_Chickadee.jpg?width=640"
  ],
  "American Kestrel": [
    "https://upload.wikimedia.org/wikipedia/commons/thumb/4/49/American_Kestrel.jpg/640px-American_Kestrel.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/4/49/American_Kestrel.jpg",
    "https://commons.wikimedia.org/wiki/Special:FilePath/American_Kestrel.jpg?width=640"
  ],
  "Common Loon": [
    "https://upload.wikimedia.org/wikipedia/commons/thumb/0/0a/Common_Loon.jpg/640px-Common_Loon.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/0/0a/Common_Loon.jpg",
    "https://commons.wikimedia.org/wiki/Special:FilePath/Common_Loon.jpg?width=640"
  ],
  "House Sparrow": [
    "https://upload.wikimedia.org/wikipedia/commons/thumb/0/0b/House_Sparrow.jpg/640px-House_Sparrow.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/0/0b/House_Sparrow.jpg",
    "https://commons.wikimedia.org/wiki/Special:FilePath/House_Sparrow.jpg?width=640"
  ],
  "Scarlet Tanager": [
    "https://upload.wikimedia.org/wikipedia/commons/thumb/8/83/Scarlet_Tanager.jpg/640px-Scarlet_Tanager.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/8/83/Scarlet_Tanager.jpg",
    "https://commons.wikimedia.org/wiki/Special:FilePath/Scarlet_Tanager.jpg?width=640"
  ],
  "Painted Bunting": [
    "https://upload.wikimedia.org/wikipedia/commons/thumb/7/78/Painted_Bunting.jpg/640px-Painted_Bunting.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/7/78/Painted_Bunting.jpg",
    "https://commons.wikimedia.org/wiki/Special:FilePath/Painted_Bunting.jpg?width=640"
  ],
  "Whooping Crane": [
    "https://upload.wikimedia.org/wikipedia/commons/thumb/5/56/Whooping_Crane.jpg/640px-Whooping_Crane.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/5/56/Whooping_Crane.jpg",
    "https://commons.wikimedia.org/wiki/Special:FilePath/Whooping_Crane.jpg?width=640"
  ],
  "California Condor": [
    "https://upload.wikimedia.org/wikipedia/commons/thumb/4/40/California_Condor.jpg/640px-California_Condor.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/4/40/California_Condor.jpg",
    "https://commons.wikimedia.org/wiki/Special:FilePath/California_Condor.jpg?width=640"
  ],
  "Peregrine Falcon": [
    "https://upload.wikimedia.org/wikipedia/commons/thumb/9/9a/Peregrine_Falcon.jpg/640px-Peregrine_Falcon.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/9/9a/Peregrine_Falcon.jpg",
    "https://commons.wikimedia.org/wiki/Special:FilePath/Peregrine_Falcon.jpg?width=640"
  ],
  "Snowy Owl": [
    "https://upload.wikimedia.org/wikipedia/commons/thumb/8/8f/Snowy_Owl.jpg/640px-Snowy_Owl.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/8/8f/Snowy_Owl.jpg",
    "https://commons.wikimedia.org/wiki/Special:FilePath/Snowy_Owl.jpg?width=640"
  ],
  "Hoopoe": [
    "https://upload.wikimedia.org/wikipedia/commons/thumb/8/88/Hoopoe.jpg/640px-Hoopoe.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/8/88/Hoopoe.jpg",
    "https://commons.wikimedia.org/wiki/Special:FilePath/Hoopoe.jpg?width=640"
  ],
  "European Kingfisher": [
    "https://upload.wikimedia.org/wikipedia/commons/thumb/3/32/Common_Kingfisher_Alcedo_atthis.jpg/640px-Common_Kingfisher_Alcedo_atthis.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/3/32/Common_Kingfisher_Alcedo_atthis.jpg",
    "https://commons.wikimedia.org/wiki/Special:FilePath/Common_Kingfisher_Alcedo_atthis.jpg?width=640"
  ],
  "Prothonotary Warbler": [
    "https://upload.wikimedia.org/wikipedia/commons/thumb/7/76/Prothonotary_Warbler.jpg/640px-Prothonotary_Warbler.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/7/76/Prothonotary_Warbler.jpg",
    "https://commons.wikimedia.org/wiki/Special:FilePath/Prothonotary_Warbler.jpg?width=640"
  ],
  "Sandhill Crane": [
    "https://upload.wikimedia.org/wikipedia/commons/thumb/3/39/Sandhill_Crane.jpg/640px-Sandhill_Crane.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/3/39/Sandhill_Crane.jpg",
    "https://commons.wikimedia.org/wiki/Special:FilePath/Sandhill_Crane.jpg?width=640"
  ],
  "Steller's Jay": [
    "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f2/Steller%27s_Jay.jpg/640px-Steller%27s_Jay.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/f/f2/Steller%27s_Jay.jpg",
    "https://commons.wikimedia.org/wiki/Special:FilePath/Steller%27s_Jay.jpg?width=640"
  ],
  "Roseate Spoonbill": [
    "https://upload.wikimedia.org/wikipedia/commons/thumb/0/07/Roseate_Spoonbill.jpg/640px-Roseate_Spoonbill.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/0/07/Roseate_Spoonbill.jpg",
    "https://commons.wikimedia.org/wiki/Special:FilePath/Roseate_Spoonbill.jpg?width=640"
  ],
  "Cedar Waxwing": [
    "https://upload.wikimedia.org/wikipedia/commons/thumb/b/b7/Cedar_Waxwing.jpg/640px-Cedar_Waxwing.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/b/b7/Cedar_Waxwing.jpg",
    "https://commons.wikimedia.org/wiki/Special:FilePath/Cedar_Waxwing.jpg?width=640"
  ],
  "Eastern Bluebird": [
    "https://upload.wikimedia.org/wikipedia/commons/thumb/9/9d/Eastern_Bluebird.jpg/640px-Eastern_Bluebird.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/9/9d/Eastern_Bluebird.jpg",
    "https://commons.wikimedia.org/wiki/Special:FilePath/Eastern_Bluebird.jpg?width=640"
  ]
};

// Location sets
const SETS = {
  all: Object.keys(CANDIDATES),
  us: ["American Robin","Northern Cardinal","Blue Jay","Mallard","California Scrub Jay","Northern Mockingbird","American Goldfinch","Downy Woodpecker","Red-tailed Hawk","Great Blue Heron","Black-capped Chickadee","American Kestrel","House Sparrow","Scarlet Tanager","Painted Bunting","Whooping Crane","California Condor","Peregrine Falcon","Snowy Owl","Prothonotary Warbler","Sandhill Crane","Steller's Jay","Roseate Spoonbill","Cedar Waxwing","Eastern Bluebird"],
  midwest: ["American Robin","American Goldfinch","Downy Woodpecker","Sandhill Crane","Whooping Crane"],
  east: ["Blue Jay","Northern Cardinal","American Goldfinch","Prothonotary Warbler","Eastern Bluebird","Scarlet Tanager"],
  west: ["California Scrub Jay","Red-tailed Hawk","California Condor","Steller's Jay"],
  south: ["Northern Mockingbird","Painted Bunting","Roseate Spoonbill"],
  canada: ["Gray Jay","Common Loon","Cedar Waxwing","Snowy Owl"],
  europe: ["European Goldfinch","Hoopoe","European Kingfisher","Peregrine Falcon","House Sparrow"]
};

let current = null;
const img = document.getElementById('birdImage');
const nameBox = document.getElementById('birdName');
const statusBox = document.getElementById('status');
const quizBtn = document.getElementById('quizBtn');
const knowBtn = document.getElementById('knowBtn');
const dontBtn = document.getElementById('dontKnowBtn');

const recent = []; const RECENT_LIMIT = 6;
function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
function pickNonRecent(pool){ let c = pick(pool); let guard=0; while(recent.includes(c) && guard<10){ c = pick(pool); guard++; } recent.push(c); if(recent.length>RECENT_LIMIT) recent.shift(); return c; }
function setStatus(t){ statusBox.innerHTML = t || ''; }

function tryLoad(urls, onOK, onFail){
  let i=0; function next(){
    if(i>=urls.length){ onFail(); return; }
    const raw = urls[i++];
    const src = viaProxy(raw) + (raw.includes('?')?'&':'?') + 'cb=' + Date.now();
    const test = new Image();
    test.referrerPolicy = 'no-referrer';
    test.crossOrigin = 'anonymous';
    test.onload = () => onOK(src);
    test.onerror = next;
    test.src = src;
  } next();
}

function showBird(){
  const location = document.querySelector('input[name="location"]:checked').value;
  const pool = SETS[location] || SETS.all;
  const name = pickNonRecent(pool);
  current = { name };
  nameBox.textContent = '';
  knowBtn.disabled = false; dontBtn.disabled = false;
  img.style.display = 'none';
  setStatus('<span class="spinner"></span> Loading image…');

  const candidates = CANDIDATES[name] || [];
  tryLoad(candidates, (goodSrc)=>{
    img.src = goodSrc; img.alt = 'Bird image'; img.style.display = 'block'; setStatus('');
  }, ()=>{
    img.src = INLINE_FALLBACK; img.alt = `${name} (fallback)`; img.style.display = 'block'; setStatus('');
  });
}

quizBtn.addEventListener('click', showBird);
knowBtn.addEventListener('click', showBird);
dontBtn.addEventListener('click', () => { if(current) nameBox.textContent = `It’s a ${current.name}.`; });
</script>
</body>
</html>
